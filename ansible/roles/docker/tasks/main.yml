---
- name: docker key
  apt_key: keyserver=p80.pool.sks-keyservers.net id=58118E89F3A912897C070ADBF76221572C52609D

- name: docker repo (jessie)
  apt_repository: repo="deb https://apt.dockerproject.org/repo debian-jessie main" state=present
  register: docker_repository
  when: ansible_distribution == 'Debian' and ansible_distribution_release == 'jessie'

- name: docker repo (trusty)
  apt_repository: repo="deb https://apt.dockerproject.org/repo ubuntu-trusty main" state=present
  register: docker_repository
  when: ansible_distribution == 'Ubuntu' and ansible_distribution_release == 'trusty'

- name: apt-get update
  apt: update_cache=yes
  when: docker_repository.changed

- name: remove old docker
  apt: pkg=lxc-docker state=absent

- name: install docker
  apt: pkg=docker-engine state=latest

- name: add user to docker group
  user: "name={{ devuser | mandatory }} groups=docker append=yes"

- name: install python pip
  apt: pkg=python-pip state=latest

- name: docker-compose
  pip: name=docker-compose state=latest