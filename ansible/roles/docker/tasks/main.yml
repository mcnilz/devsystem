---
- name: docker key
  apt_key: keyserver=keyserver.ubuntu.com id=36A1D7869245C8950F966E92D8576A8BA88D21E9
  
- name: docker repo
  apt_repository: repo="deb https://get.docker.com/ubuntu docker main" state=present

- name: install docker
  apt: pkg=lxc-docker state=latest
  
- name: add user to docker group
  user: "name={{ devuser | mandatory }} groups=docker append=yes"

- name: Projects directory
  file: path={{ devhome | mandatory }}/projects state=directory owner={{ devuser | mandatory }} group={{ devuser | mandatory }} mode=0750

- name: Docker directory
  file: path={{ devhome | mandatory }}/docker/phpmysql state=directory owner={{ devuser | mandatory }} group={{ devuser | mandatory }} mode=0750

- name: Copy dockerfile
  template: "src=Dockerfile.j2 dest={{ devhome | mandatory }}/docker/phpmysql/Dockerfile mode=0640 owner={{ devuser | mandatory }} group={{ devuser | mandatory }}"
  
- name: Copy apache conf
  template: "src=default.conf.j2 dest={{ devhome | mandatory }}/docker/phpmysql/default.conf mode=0640 owner={{ devuser | mandatory }} group={{ devuser | mandatory }}"